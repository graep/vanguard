<ion-content class="user-review-content">
  <!-- Page Header with Breadcrumb and Logout -->
  <app-page-header 
    [breadcrumbItems]="breadcrumbItems" 
    (logout)="logout()">
  </app-page-header>
  
  <div class="user-review-container">
    <!-- Hero Section -->
    <div class="hero-section">
      <div class="hero-content">
        <h1 class="hero-title">{{ vanType }} {{ vanNumber }}</h1>
        <p class="hero-subtitle">Complete your inspection by reporting any issues found</p>
        <div class="inspection-status">
          <ion-icon name="checkmark-circle" class="status-icon"></ion-icon>
          <span class="status-text">Photos captured successfully</span>
        </div>
      </div>
    </div>

    <!-- No Issues Card -->
    <div class="no-issues-card" (click)="toggleNoIssues()">
      <div class="card-header">
        <div class="card-icon">
          <ion-icon name="checkmark-circle"></ion-icon>
        </div>
        <div class="card-content">
          <h3 class="card-title">No Issues Found</h3>
          <p class="card-description">Check this if no issues were found during inspection</p>
        </div>
      </div>
      <ion-checkbox
        [(ngModel)]="noIssues"
        class="main-checkbox"
        (click)="$event.stopPropagation()">
      </ion-checkbox>
    </div>

    <!-- Issue Categories Section -->
    <div class="categories-section" *ngIf="!noIssues">
      <div class="section-header">
        <h2 class="section-title">Report Issues by Category</h2>
        <p class="section-subtitle">Select any categories where issues were found</p>
      </div>

      <div class="categories-container">
        <div *ngFor="let cat of issueCategories" 
             class="category-card" 
             [class.selected]="cat.hasIssue"
             (click)="toggleCategory(cat)">
          <div class="category-header">
            <div class="category-icon" [class]="'severity-' + cat.severity">
              <ion-icon [name]="getCategoryIcon(cat.name)"></ion-icon>
            </div>
            <div class="category-info">
              <h3 class="category-title">{{ cat.name }}</h3>
              <p class="category-severity">{{ cat.severity | titlecase }} Priority</p>
            </div>
            <ion-checkbox
              [(ngModel)]="cat.hasIssue"
              class="category-checkbox"
              (click)="$event.stopPropagation()">
            </ion-checkbox>
          </div>

          <!-- Issue Details (shown when category is selected) -->
          <div class="issue-details" *ngIf="cat.hasIssue">
            <!-- Subcategory Selection -->
            <div class="subcategory-section" *ngIf="cat.subcategories?.length">
              <label class="form-label">Which area?</label>
              <ion-select
                [(ngModel)]="cat.selectedSubcategory"
                placeholder="Select specific area"
                class="subcategory-select">
                <ion-select-option
                  *ngFor="let sub of cat.subcategories"
                  [value]="sub">
                  {{ sub }}
                </ion-select-option>
              </ion-select>
            </div>

            <!-- Details Textarea -->
            <div class="details-section">
              <label class="form-label">Describe the issue</label>
              <ion-textarea
                [(ngModel)]="cat.details"
                [placeholder]="'Describe issues with ' + (cat.selectedSubcategory || cat.name)"
                auto-grow="true"
                class="details-textarea">
              </ion-textarea>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="submit-section">
      <ion-button
        class="submit-button"
        (click)="submitReview()"
        [disabled]="!canSubmit"
        expand="block">
        <ion-icon name="checkmark-circle" slot="start"></ion-icon>
        Submit Review
      </ion-button>
    </div>
  </div>
</ion-content>
