<app-header class ="ion-text-center" title="{{ vanType }} - {{ vanNumber }} Review"></app-header>

<ion-content class="ion-padding">
  <!-- 1️⃣ No-Issues Checkbox -->
  <ion-list>
    <ion-item>
      <ion-checkbox
        slot="start"
        [(ngModel)]="noIssues"
      ></ion-checkbox>
      <ion-label>No issues / Already Reported</ion-label>
    </ion-item>
  </ion-list>

  <!-- 2️⃣ Only show categories if they DIDN'T check “no issues” -->
  <ng-container *ngIf="!noIssues">
    <h2 class="ion-margin-top">Any additional issues to report?</h2>

    <!-- Checklist of categories -->
    <ng-container *ngFor="let cat of issueCategories">
      <ion-item>
        <ion-checkbox
          slot="start"
          [(ngModel)]="cat.hasIssue"
        ></ion-checkbox>
        <ion-label>{{ cat.name }}</ion-label>
      </ion-item>

      <ng-container *ngIf="cat.hasIssue">
        <!-- Optional dropdown for Powertrain (or any with subcategories) -->
        <ion-item *ngIf="cat.subcategories?.length">
          <ion-label>Which area?</ion-label>
          <ion-select
            placeholder="Select area"
            [(ngModel)]="cat.selectedSubcategory"
          >
            <ion-select-option
              *ngFor="let sub of cat.subcategories"
              [value]="sub"
            >
              {{ sub }}
            </ion-select-option>
          </ion-select>
        </ion-item>

        <!-- Always show the details textarea -->
        <ion-item>
          <ion-textarea
            [(ngModel)]="cat.details"
            [placeholder]="'Describe issues with ' + (cat.selectedSubcategory || cat.name)"
            auto-grow="true"
          ></ion-textarea>
        </ion-item>
      </ng-container>
    </ng-container>
  </ng-container>

  <!-- 3️⃣ Submit button enabled if noIssues OR at least one checked category -->
  <ion-button
    expand="block"
    class="ion-margin-top"
    (click)="submitReview()"
    [disabled]="!canSubmit"
  >
    Submit Review
  </ion-button>
</ion-content>
