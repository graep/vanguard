<app-admin-navbar></app-admin-navbar>
<ion-content class="ion-padding">
  <div class="content-container">

    <!-- Main Fleet Status Bar - handles search and filtering automatically -->
    <div class="status-bar-container">
      <app-status-count-bar
        [dataSource]="overallDataSource"
        [showProgress]="true"
        [clickable]="true"
        [searchPlaceholder]="'Search by #, VIN or Type'"
        (filteredData)="onOverallFilteredData($event)"
        variant="default">
      </app-status-count-bar>
    </div>

    <!-- Van List -->
    <div class="van-list">
      <!-- EDV Section -->
      <div class="section-header">
        <h3 class="section-title">EDV</h3>
      </div>

      <ion-grid>
        <ion-row>
          <ion-col size="12" size-md="6" size-lg="4" *ngFor="let van of filteredEdvs" (click)="viewVan(van)">
            <div class="van-card">
              <div class="van-card-content">
                <img [src]="'assets/EDV.jpg'" alt="EDV" class="van-image"/>
                <div class="van-details">
                  <h4 class="van-id">{{ van.number || 'Unknown' }}</h4>
                  <div class="van-type">Electric Delivery Van</div>
                  <div class="van-status">
                    <span class="status-indicator" [class.active]="!van.isGrounded" [class.grounded]="van.isGrounded"></span>
                    <span class="status-text" [class.active]="!van.isGrounded" [class.grounded]="van.isGrounded">
                      {{ van.isGrounded ? 'Grounded' : 'Active' }}
                    </span>
                  </div>
                </div>
                <div class="van-info" *ngIf="van.vin">
                  <div class="van-vin">{{ van.vin | slice:0:8 }}...</div>
                  <div class="last-inspection">Click to inspect</div>
                </div>
              </div>
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>

      <!-- CDV Section -->
      <div class="section-header">
        <h3 class="section-title">CDV</h3>
      </div>

      <ion-grid>
        <ion-row>
          <ion-col size="12" size-md="6" size-lg="4" *ngFor="let van of filteredCdvs" (click)="viewVan(van)">
            <div class="van-card">
              <div class="van-card-content">
                <img [src]="'assets/CDV.jpg'" alt="CDV" class="van-image"/>
                <div class="van-details">
                  <h4 class="van-id">{{ van.number || 'Unknown' }}</h4>
                  <div class="van-type">Cargo Delivery Van</div>
                  <div class="van-status">
                    <span class="status-indicator" [class.active]="!van.isGrounded" [class.grounded]="van.isGrounded"></span>
                    <span class="status-text" [class.active]="!van.isGrounded" [class.grounded]="van.isGrounded">
                      {{ van.isGrounded ? 'Grounded' : 'Active' }}
                    </span>
                  </div>
                </div>
                <div class="van-info" *ngIf="van.vin">
                  <div class="van-vin">{{ van.vin | slice:0:8 }}...</div>
                  <div class="last-inspection">Click to inspect</div>
                </div>
              </div>
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
      
      <div class="empty-state" *ngIf="filteredEdvs.length === 0 && filteredCdvs.length === 0">
        <ion-icon name="car-outline"></ion-icon>
        <p>No vans found matching your search criteria</p>
      </div>
    </div>
  </div>
</ion-content>